<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dev.mapper.IntrBrdMapper">
	<select id="list" resultType="IntrBrd">
		SELECT   tblNm.*
		FROM(
			SELECT   ${tblNm}.*
   					,ROW_NUMBER() OVER(ORDER BY #{tblNm}.boardCd ASC) AS rNum
			FROM ${tblNm}
		) tblNm
		WHERE rNum BETWEEN #{cri.rowStart} AND #{cri.rowEnd}
		ORDER BY tblNm.boardCd ASC
	</select>
	
	<select id="listCount" resultType="int" parameterType="String">
	    SELECT COUNT(*)
	    FROM ${tblNm}
	</select>
	
	<select id="top10" resultType="IntrBrd" parameterType="Criteria">
			SELECT   tb_board_notice.*
		FROM(
			SELECT   tb_board_notice.*
   				,ROW_NUMBER() OVER(ORDER BY tb_board_notice.boardCd ASC) AS rNum
			FROM tb_board_notice
		) tb_board_notice
		WHERE (rNum BETWEEN 1 AND 10)  AND hit > 0
		ORDER BY tb_board_notice.hit DESC
	</select>
	

	
	<select id="listCount2" resultType="int">
	    SELECT COUNT(*)
	    FROM tb_board_notice
	</select>
	
	<select id="listCount3" resultType="int">
	    SELECT COUNT(*)
	    FROM tb_board_faq
	</select>
	
	<select id="search" resultType="IntrBrd" parameterType="IntrBrd">		 	
		SELECT   brd.*
	  		FROM(
	 				SELECT   brd.*
			    			,ROW_NUMBER() OVER(ORDER BY brd.boardCd ASC) AS rNum
	 				FROM (	
	 					SELECT * FROM tb_board_notice 
						WHERE (CASE 
							WHEN #{intrBrd.srchKey} = 't' || #{intrBrd.srchKey} = 'c' THEN boardTitle
							WHEN #{intrBrd.srchKey} = 'tc' THEN boardTitle
							WHEN #{intrBrd.srchKey} = 'w'  THEN regId
							ELSE NULL
						END) LIKE '%${intrBrd.srch}%'
						|| (CASE 
							WHEN #{intrBrd.srchKey} = 'c' THEN boardContent
							ELSE NULL
						END) LIKE '%${intrBrd.srch}%'
					) brd
			) brd
			WHERE rNum BETWEEN #{cri.rowStart} AND #{cri.rowEnd}
			ORDER BY brd.boardCd ASC
	</select>
	
	<select id="dtl" resultType="IntrBrd" parameterType="String">
	    SELECT *
	    FROM tb_board_notice
	    WHERE boardCd = #{boardCd}
	</select>
	
	<select id="dtl2" resultType="IntrFaq" parameterType="String">
	    SELECT *
	    FROM tb_board_faq
	    WHERE brdCd = #{brdCd}
	</select>
	
	<insert id="insert">
		INSERT INTO 
			tb_board_notice (
				 boardCd
				,boardTitle
				,boardContent
				,regId
				,regDt
				,fileYn
				,ancmOptnYn
			)
		VALUES (
				 #{boardCd}
				,#{boardTitle}
				,#{boardContent}
				,#{regId}
				,now()
				,#{fileYn}
				,#{ancmOptnYn}
		)
	</insert>
	
	<insert id="insert2">
		INSERT INTO 
			tb_board_faq (
				 brdCd
				,brdType
				,brdTl
				,brdCont
				,regId
				,regDt
				,useYn
			)
		VALUES (
				 #{brdCd}
				,#{brdType}
				,#{brdTl}
				,#{brdCont}
				,#{regId}
				,now()
				,#{useYn}
		)
	</insert>
	
	<select id="brdCdMax" resultType="int">
		SELECT MAX(brdCd) FROM tb_board_faq
	</select>
	
	<select id="boardCdMax" resultType="int">
		SELECT MAX(boardCd) FROM tb_board_notice
	</select>
	
	<delete id="delete" parameterType="int">
		DELETE 
		FROM tb_board_notice
		WHERE boardCd = #{boardCd}
	</delete>
	
	<update id="update" parameterType="IntrBrd">
		UPDATE tb_board_notice
		SET	
			 boardTitle = #{boardTitle}
			,boardContent = #{boardContent}
			,fileYn = #{fileYn}
			,ancmOptnYn = #{ancmOptnYn}
		WHERE boardCd = #{boardCd}
	</update>
	
	<delete id="delete2" parameterType="int">
		DELETE 
		FROM tb_board_faq
		WHERE brdCd = #{brdCd}
	</delete>
	
	<update id="update2" parameterType="IntrFaq">
		UPDATE tb_board_faq
		SET	
			 brdType = #{brdType}
			,brdTl = #{brdTl}
			,brdCont = #{brdCont}
			,useYn = #{useYn}
		WHERE brdCd = #{brdCd}
	</update>
	
	<select id="getFaq" resultType="IntrFaq" parameterType="Criteria">
		SELECT   faq.*
		FROM(
			SELECT   tb_board_faq.*
   				,ROW_NUMBER() OVER(ORDER BY tb_board_faq.brdCd ASC) AS rNum
			FROM tb_board_faq
		) faq
		WHERE rNum BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY faq.brdCd ASC
	</select>
		
	<!-- 게시판 조회수 -->
    <update id="boardHit" parameterType="int">
    	UPDATE 
			tb_board_faq
		SET	
    		hit = ${hit}+1
    	WHERE brdCd = ${brdCd}
    </update>
</mapper>