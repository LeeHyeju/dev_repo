<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dev.mapper.IntrBrdMapper">
	<select id="postList" resultType="IntrBrd">
		SELECT   noti.*
  		FROM(
 				SELECT   noti.*
		    			,ROW_NUMBER() OVER(ORDER BY noti.regDt DESC) AS rNum
 				FROM (	
 					SELECT noti.* 
 					FROM (
 						SELECT * FROM tb_intr_brd_noti
						WHERE brdType = '3'
						AND
						(CASE 
				 		 	WHEN #{searchKey.srchPeriod} = '1d'
				 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 DAY) AND NOW()
				 		 	WHEN #{searchKey.srchPeriod} = '1w'
				 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 WEEK) AND NOW()
				 		 	WHEN #{searchKey.srchPeriod} = '1m'
				 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 MONTH) AND NOW()
				 		 	WHEN #{searchKey.srchPeriod} = '6m'
				 		 			THEN regDt BETWEEN (NOW() + INTERVAL -6 MONTH) AND NOW()
				 		 	WHEN #{searchKey.srchPeriod} = '1y'
				 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 YEAR) AND NOW()
				 		 	ELSE 1=1
				 		END)	
 					) noti 
					WHERE (CASE 
						WHEN #{searchKey.srchKey} = 't' OR #{searchKey.srchKey} = 'tc' THEN brdTl
						WHEN #{searchKey.srchKey} = 'c'  THEN brdCont
						WHEN #{searchKey.srchKey} = 'w'  THEN regId
						ELSE brdTl
					END) LIKE '%${searchKey.srchCont}%'
					OR (CASE 
						WHEN #{searchKey.srchKey} = 'tc' THEN brdCont
						ELSE NULL
					END) LIKE '%${searchKey.srchCont}%'
				) noti
		) noti
		WHERE rNum BETWEEN #{cri.rowStart} AND #{cri.rowEnd}
	</select>
	
	<select id="postListCount" resultType="int" parameterType="SearchKey">
	    SELECT COUNT(*)
	    FROM (
			SELECT * FROM tb_intr_brd_noti
			WHERE brdType = '3'
			AND
			(CASE 
	 		 	WHEN #{srchPeriod} = '1d'
	 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 DAY) AND NOW()
	 		 	WHEN #{srchPeriod} = '1w'
	 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 WEEK) AND NOW()
	 		 	WHEN #{srchPeriod} = '1m'
	 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 MONTH) AND NOW()
	 		 	WHEN #{srchPeriod} = '6m'
	 		 			THEN regDt BETWEEN (NOW() + INTERVAL -6 MONTH) AND NOW()
	 		 	WHEN #{srchPeriod} = '1y'
	 		 			THEN regDt BETWEEN (NOW() + INTERVAL -1 YEAR) AND NOW()
	 		 	ELSE 1=1
	 		END)
		) noti 
    	WHERE (CASE 
			WHEN #{srchKey} = 't' OR #{srchKey} = 'tc' THEN brdTl
			WHEN #{srchKey} = 'c'  THEN brdCont
			WHEN #{srchKey} = 'w'  THEN regId
			ELSE brdTl
		END) LIKE '%${srchCont}%'
		OR (CASE 
			WHEN #{srchKey} = 'tc' THEN brdCont
			ELSE NULL
		END) LIKE '%${srchCont}%'
	</select>
	
	<select id="notiList" resultType="IntrBrd">
		SELECT  tb_intr_brd_noti.* 
			   ,ROW_NUMBER() OVER(ORDER BY tb_intr_brd_noti.brdType ASC) AS rNum
		FROM tb_intr_brd_noti
 		WHERE brdType = '1' OR brdType = '2'
	</select>
	
    <update id="brdHit">
    	UPDATE 
			${tblNm}
		SET	
    		hit = ${hit}+1
    	WHERE brdCd = ${brdCd}
    </update>

	
	
	
	<select id="top10" resultType="IntrBrd" parameterType="Criteria">
			SELECT   tb_board_notice.*
		FROM(
			SELECT   tb_board_notice.*
   				,ROW_NUMBER() OVER(ORDER BY tb_board_notice.boardCd ASC) AS rNum
			FROM tb_board_notice
		) tb_board_notice
		WHERE (rNum BETWEEN 1 AND 10)  AND hit > 0
		ORDER BY tb_board_notice.hit DESC
	</select>
	

	
	<select id="listCount2" resultType="int">
	    SELECT COUNT(*)
	    FROM tb_board_notice
	</select>
	
	<select id="listCount3" resultType="int">
	    SELECT COUNT(*)
	    FROM tb_board_faq
	</select>
	
	
	<select id="dtl" resultType="IntrBrd" parameterType="String">
	    SELECT *
	    FROM tb_board_notice
	    WHERE boardCd = #{boardCd}
	</select>
	
	<select id="dtl2" resultType="IntrFaq" parameterType="String">
	    SELECT *
	    FROM tb_board_faq
	    WHERE brdCd = #{brdCd}
	</select>
	
	<insert id="insert">
		INSERT INTO 
			tb_board_notice (
				 boardCd
				,boardTitle
				,boardContent
				,regId
				,regDt
				,fileYn
				,ancmOptnYn
			)
		VALUES (
				 #{boardCd}
				,#{boardTitle}
				,#{boardContent}
				,#{regId}
				,now()
				,#{fileYn}
				,#{ancmOptnYn}
		)
	</insert>
	
	<insert id="insert2">
		INSERT INTO 
			tb_board_faq (
				 brdCd
				,brdType
				,brdTl
				,brdCont
				,regId
				,regDt
				,useYn
			)
		VALUES (
				 #{brdCd}
				,#{brdType}
				,#{brdTl}
				,#{brdCont}
				,#{regId}
				,now()
				,#{useYn}
		)
	</insert>
	
	<select id="brdCdMax" resultType="int">
		SELECT MAX(brdCd) FROM tb_board_faq
	</select>
	
	<select id="boardCdMax" resultType="int">
		SELECT MAX(boardCd) FROM tb_board_notice
	</select>
	
	<delete id="delete" parameterType="int">
		DELETE 
		FROM tb_board_notice
		WHERE boardCd = #{boardCd}
	</delete>
	
	<update id="update" parameterType="IntrBrd">
		UPDATE tb_board_notice
		SET	
			 boardTitle = #{boardTitle}
			,boardContent = #{boardContent}
			,fileYn = #{fileYn}
			,ancmOptnYn = #{ancmOptnYn}
		WHERE boardCd = #{boardCd}
	</update>
	
	<delete id="delete2" parameterType="int">
		DELETE 
		FROM tb_board_faq
		WHERE brdCd = #{brdCd}
	</delete>
	
	<update id="update2" parameterType="IntrFaq">
		UPDATE tb_board_faq
		SET	
			 brdType = #{brdType}
			,brdTl = #{brdTl}
			,brdCont = #{brdCont}
			,useYn = #{useYn}
		WHERE brdCd = #{brdCd}
	</update>
	
	<select id="getFaq" resultType="IntrFaq" parameterType="Criteria">
		SELECT   faq.*
		FROM(
			SELECT   tb_board_faq.*
   				,ROW_NUMBER() OVER(ORDER BY tb_board_faq.brdCd ASC) AS rNum
			FROM tb_board_faq
		) faq
		WHERE rNum BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY faq.brdCd ASC
	</select>
		
	<!-- 게시판 조회수 -->
    <update id="boardHit" parameterType="int">
    	UPDATE 
			tb_board_faq
		SET	
    		hit = ${hit}+1
    	WHERE brdCd = ${brdCd}
    </update>
</mapper>